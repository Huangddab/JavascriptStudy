<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒ–å­¦æ¯’æ°”ç›‘æµ‹ç³»ç»Ÿ HMI</title>
    <style>
        /* å·¥ä¸šç§‘æŠ€é£CSSå˜é‡ */
        :root {
            --color-bg: #1A1A1A;
            --color-primary: #00C8FF;
            --color-warning: #FFC107;
            --color-danger: #F44336;
            --color-safe: #4CAF50;
            --font-main: 'Arial Narrow', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            width: 1024px;
            height: 600px;
            background-color: var(--color-bg);
            color: white;
            font-family: var(--font-main);
            overflow: hidden;
            touch-action: manipulation;
        }

        /* ä¸»ç•Œé¢å®¹å™¨ */
        #app {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* çŠ¶æ€æ  (æ–‡æ¡£3è®¾å¤‡å¥åº·è¯Šæ–­) */
        .status-bar {
            height: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            background-color: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid #333;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ä¸­å¤®ä»ªè¡¨ç›˜ (æ–‡æ¡£1æ ¸å¿ƒåŠŸèƒ½) */
        .gauge-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .comfort-gauge {
            width: 400px;
            height: 400px;
            border-radius: 50%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background: conic-gradient(
                var(--color-danger) 0deg,
                var(--color-warning) 120deg,
                var(--color-safe) 240deg
            );
            box-shadow: 0 0 30px rgba(0, 200, 255, 0.2);
        }

        .gauge-inner {
            width: 80%;
            height: 80%;
            border-radius: 50%;
            background-color: var(--color-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 72px;
            font-weight: bold;
        }

        /* ç¯å¢ƒå‚æ•°æ  (æ–‡æ¡£2å¾®å°æ°”å€™æ¨¡å—) */
        .env-params {
            height: 80px;
            display: flex;
            justify-content: space-around;
            padding: 0 50px;
        }

        .param-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 120px;
        }

        .param-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .param-bar {
            width: 100%;
            height: 10px;
            background-color: #333;
            border-radius: 5px;
            overflow: hidden;
        }

        .param-fill {
            height: 100%;
            background-color: var(--color-primary);
            transition: width 0.5s ease;
        }

        /* å¼‚å¸¸è­¦æŠ¥å¼¹çª— (æ–‡æ¡£1æŠ¥è­¦åŠŸèƒ½) */
        .alert-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(244, 67, 54, 0.3);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            animation: pulseBg 2s infinite;
        }

        .alert-content {
            background-color: var(--color-bg);
            border: 3px solid var(--color-danger);
            border-radius: 10px;
            padding: 30px;
            width: 80%;
            text-align: center;
        }

        .hazard-icon {
            font-size: 72px;
            margin-bottom: 20px;
        }

        .hazard-name {
            font-size: 36px;
            color: var(--color-danger);
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .concentration {
            font-size: 48px;
            font-weight: bold;
        }

        .alert-actions {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .alert-btn {
            padding: 10px 30px;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            background-color: #333;
            color: white;
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes pulseBg {
            0% { background-color: rgba(244, 67, 54, 0.3); }
            50% { background-color: rgba(244, 67, 54, 0.6); }
            100% { background-color: rgba(244, 67, 54, 0.3); }
        }

        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .blink {
            animation: blink 1s infinite;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- çŠ¶æ€æ  -->
        <div class="status-bar">
            <div class="status-item">
                <span id="network-status">ğŸ“¶</span>
                <span>COM1</span>
            </div>
            <div class="status-item">
                <span id="battery-icon">ğŸ”‹</span>
                <span id="battery-level">100%</span>
            </div>
            <div class="status-item">
                <span id="current-time">12:30:45</span>
            </div>
        </div>

        <!-- ä¸»ä»ªè¡¨ç›˜ -->
        <div class="gauge-container">
            <div class="comfort-gauge">
                <div class="gauge-inner" id="comfort-value">85</div>
            </div>
        </div>

        <!-- ç¯å¢ƒå‚æ•° -->
        <div class="env-params">
            <div class="param-item">
                <div class="param-icon">ğŸŒ¡</div>
                <div class="param-bar">
                    <div class="param-fill" id="temp-bar" style="width: 50%"></div>
                </div>
                <div id="temp-value">25Â°C</div>
            </div>
            <div class="param-item">
                <div class="param-icon">ğŸ’§</div>
                <div class="param-bar">
                    <div class="param-fill" id="humidity-bar" style="width: 60%"></div>
                </div>
                <div id="humidity-value">60%</div>
            </div>
            <div class="param-item">
                <div class="param-icon">ğŸ’¨</div>
                <div class="param-bar">
                    <div class="param-fill" id="pm25-bar" style="width: 30%"></div>
                </div>
                <div id="pm25-value">30Âµg/mÂ³</div>
            </div>
        </div>

        <!-- å¼‚å¸¸è­¦æŠ¥ -->
        <div class="alert-overlay" id="alert-overlay">
            <div class="alert-content">
                <div class="hazard-icon">âš ï¸</div>
                <div class="hazard-name" id="hazard-name">æ²™æ—æ¯’æ°”</div>
                <div class="concentration" id="concentration-value">12.5 ppm</div>
                <div class="alert-actions">
                    <button class="alert-btn" id="silence-btn">é™éŸ³</button>
                    <button class="alert-btn" id="emergency-btn">åº”æ€¥å¤„ç½®</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç³»ç»ŸçŠ¶æ€ (æ–‡æ¡£3è¿è¡ŒçŠ¶æ€)
        const systemState = {
            comfort: 85,
            temperature: 25,
            humidity: 60,
            pm25: 30,
            battery: 100,
            network: true,
            hazards: {
                detected: false,
                type: null,
                concentration: 0
            }
        };

        // æ¯’æ°”åº“æ˜ å°„ (æ–‡æ¡£1æ¯’æ°”åº“)
        const hazardMap = {
            0x01: { name: "æ²™æ—æ¯’æ°”", threshold: 0.1, unit: "ppm" },
            0x02: { name: "æ°¯æ°”", threshold: 5, unit: "ppm" },
            0x03: { name: "ç¡«åŒ–æ°¢", threshold: 10, unit: "ppm" },
            0x04: { name: "æ°ŸåŒ–æ°¢", threshold: 3, unit: "ppm" },
            0x05: { name: "æ°¨æ°”", threshold: 25, unit: "ppm" }
        };

        // DOMå…ƒç´ 
        const elements = {
            comfortValue: document.getElementById('comfort-value'),
            tempBar: document.getElementById('temp-bar'),
            tempValue: document.getElementById('temp-value'),
            humidityBar: document.getElementById('humidity-bar'),
            humidityValue: document.getElementById('humidity-value'),
            pm25Bar: document.getElementById('pm25-bar'),
            pm25Value: document.getElementById('pm25-value'),
            batteryLevel: document.getElementById('battery-level'),
            networkStatus: document.getElementById('network-status'),
            currentTime: document.getElementById('current-time'),
            alertOverlay: document.getElementById('alert-overlay'),
            hazardName: document.getElementById('hazard-name'),
            concentrationValue: document.getElementById('concentration-value'),
            silenceBtn: document.getElementById('silence-btn'),
            emergencyBtn: document.getElementById('emergency-btn')
        };

        // æ›´æ–°ç•Œé¢å‡½æ•°
        function updateUI() {
            // èˆ’é€‚åº¦ (æ–‡æ¡£3å®æ—¶ç›‘æµ‹)
            elements.comfortValue.textContent = systemState.comfort;
            updateGaugeColor();
            
            // ç¯å¢ƒå‚æ•° (æ–‡æ¡£2å¾®å°æ°”å€™æ¨¡å—)
            elements.tempBar.style.width = `${systemState.temperature}%`;
            elements.tempValue.textContent = `${systemState.temperature}Â°C`;
            
            elements.humidityBar.style.width = `${systemState.humidity}%`;
            elements.humidityValue.textContent = `${systemState.humidity}%`;
            
            elements.pm25Bar.style.width = `${systemState.pm25}%`;
            elements.pm25Value.textContent = `${systemState.pm25}Âµg/mÂ³`;
            
            // çŠ¶æ€æ 
            elements.batteryLevel.textContent = `${systemState.battery}%`;
            elements.networkStatus.textContent = systemState.network ? "ğŸ“¶" : "âŒ";
            
            // è­¦æŠ¥çŠ¶æ€
            if (systemState.hazards.detected) {
                showAlert();
            } else {
                hideAlert();
            }
        }

        // æ›´æ–°ä»ªè¡¨ç›˜é¢œè‰²
        function updateGaugeColor() {
            const gauge = document.querySelector('.comfort-gauge');
            if (systemState.comfort >= 70) {
                gauge.style.background = `conic-gradient(
                    var(--color-safe) 0deg,
                    var(--color-safe) 240deg,
                    var(--color-warning) 240deg,
                    var(--color-danger) 360deg
                )`;
            } else if (systemState.comfort >= 40) {
                gauge.style.background = `conic-gradient(
                    var(--color-warning) 0deg,
                    var(--color-warning) 240deg,
                    var(--color-danger) 240deg,
                    var(--color-danger) 360deg
                )`;
            } else {
                gauge.style.background = 'var(--color-danger)';
            }
        }

        // æ˜¾ç¤ºè­¦æŠ¥ (æ–‡æ¡£1æŠ¥è­¦åŠŸèƒ½)
        function showAlert() {
            const hazard = hazardMap[systemState.hazards.type] || { name: "æœªçŸ¥å±é™©", unit: "ppm" };
            elements.hazardName.textContent = hazard.name;
            elements.concentrationValue.textContent = 
                `${systemState.hazards.concentration.toFixed(2)} ${hazard.unit}`;
            elements.alertOverlay.style.display = 'flex';
        }

        function hideAlert() {
            elements.alertOverlay.style.display = 'none';
        }

        // æ¨¡æ‹Ÿä¸²å£æ•°æ®è§£æ (æ–‡æ¡£2 AeroNBCåè®®)
        function parseSerialData(data) {
            // ç¤ºä¾‹: æ¨¡æ‹Ÿè§£æåŒ–å­¦æ¨¡å—æ•°æ®å¸§ AA 0B 01 B0 02 00 05 00 C3 44 0D 0A
            if (data.startsWith('AA') && data.length >= 12) {
                const destAddr = parseInt(data.substr(2, 2), 16);
                const srcAddr = parseInt(data.substr(4, 2), 16);
                const cmd = parseInt(data.substr(6, 2), 16);
                const dataLen = parseInt(data.substr(10, 2) + data.substr(8, 2), 16);
                
                // åŒ–å­¦æ¨¡å—æ£€æµ‹æ•°æ® (æ–‡æ¡£2åŒ–å­¦æ¨¡å—éƒ¨åˆ†)
                if (cmd === 0xB0 && dataLen === 2) {
                    const concentration = parseInt(data.substr(12, 4), 16) / 100;
                    
                    // æ£€æŸ¥æ˜¯å¦è¶…è¿‡é˜ˆå€¼
                    for (const [type, spec] of Object.entries(hazardMap)) {
                        if (concentration > spec.threshold) {
                            systemState.hazards = {
                                detected: true,
                                type: parseInt(type),
                                concentration: concentration
                            };
                            break;
                        }
                    }
                }
                
                // ç¯å¢ƒæ¸©æ¹¿åº¦æ•°æ® (æ–‡æ¡£2ä¸»æ§åˆ¶å™¨éƒ¨åˆ†)
                else if (cmd === 0xA0 && dataLen === 4) {
                    systemState.temperature = parseInt(data.substr(12, 4), 16) / 10;
                    systemState.humidity = parseInt(data.substr(16, 4), 16) / 10;
                }
                
                // ç”µæ± çŠ¶æ€ (æ–‡æ¡£2åŠŸèƒ½ç 0xA3)
                else if (cmd === 0xA3 && dataLen === 2) {
                    systemState.battery = parseInt(data.substr(12, 4), 16);
                }
                
                updateUI();
            }
        }

        // æ¨¡æ‹Ÿæ•°æ®æ›´æ–°
        function simulateData() {
            // éšæœºå˜åŒ–ç¯å¢ƒå‚æ•°
            systemState.temperature = clamp(systemState.temperature + (Math.random() - 0.5), 15, 35);
            systemState.humidity = clamp(systemState.humidity + (Math.random() - 0.3), 30, 80);
            systemState.pm25 = clamp(systemState.pm25 + (Math.random() * 10 - 5), 0, 300);
            
            // è®¡ç®—èˆ’é€‚åº¦æŒ‡æ•° (æ–‡æ¡£3æ™ºèƒ½ç®—æ³•)
            systemState.comfort = Math.round(
                100 - (
                    Math.abs(systemState.temperature - 22) * 1.5 +
                    Math.abs(systemState.humidity - 55) * 0.7 +
                    systemState.pm25 * 0.1
                )
            );
            
            // éšæœºè§¦å‘è­¦æŠ¥æµ‹è¯•
            if (Math.random() < 0.02) {
                const hazardTypes = Object.keys(hazardMap);
                const randomType = hazardTypes[Math.floor(Math.random() * hazardTypes.length)];
                systemState.hazards = {
                    detected: true,
                    type: parseInt(randomType),
                    concentration: hazardMap[randomType].threshold * (1 + Math.random() * 5)
                };
            } else if (Math.random() < 0.1) {
                systemState.hazards.detected = false;
            }
            
            updateUI();
        }

        // å·¥å…·å‡½æ•°
        function clamp(value, min, max) {
            return Math.min(Math.max(value, min), max);
        }

        // äº‹ä»¶ç›‘å¬
        elements.silenceBtn.addEventListener('click', () => {
            // å‘é€èœ‚é¸£å™¨å…³é—­å‘½ä»¤ (æ–‡æ¡£2åŠŸèƒ½ç 0xA9)
            console.log("å‘é€é™éŸ³å‘½ä»¤: AA 01 0A A9 01 00 00 00 0D 0A");
            systemState.hazards.detected = false;
            updateUI();
        });

        elements.emergencyBtn.addEventListener('click', () => {
            // å‘é€åº”æ€¥å¤„ç½®å‘½ä»¤ (æ–‡æ¡£2åŠŸèƒ½ç 0xA7å…³é—­æ‰€æœ‰ç”µç£é˜€)
            console.log("å‘é€åº”æ€¥å¤„ç½®å‘½ä»¤: AA 01 0A A7 05 00 00 00 00 00 00 0D 0A");
            systemState.hazards.detected = false;
            updateUI();
        });

        // åˆå§‹åŒ–æ—¶é’Ÿ
        function updateClock() {
            const now = new Date();
            elements.currentTime.textContent = 
                `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
        }

        // å¯åŠ¨æ¨¡æ‹Ÿ
        setInterval(simulateData, 2000);
        setInterval(updateClock, 1000);
        updateUI();
        updateClock();

        // æ¨¡æ‹Ÿæ¥æ”¶ä¸²å£æ•°æ®
        setInterval(() => {
            // éšæœºé€‰æ‹©æ¨¡æ‹Ÿæ•°æ®å¸§
            const frames = [
                'AA0B01B002000500C3440D0A',  // åŒ–å­¦æ£€æµ‹æ­£å¸¸
                'AA0B01B002000F00C3440D0A',  // åŒ–å­¦æ£€æµ‹è¶…æ ‡
                'AA010AA0040010020D020D0A',  // æ¸©æ¹¿åº¦æ•°æ®
                'AA010AA302001E0D0A',        // ç”µæ± ç”µå‹
                'AA010BB0020005000D0A'       // PIDæ•°æ®
            ];
            const randomFrame = frames[Math.floor(Math.random() * frames.length)];
            parseSerialData(randomFrame);
        }, 1500);
    </script>
</body>
</html>