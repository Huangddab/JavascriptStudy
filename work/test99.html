<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能报警策略管理</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .rule-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.03) 100%);
            backdrop-filter: blur(8px);
        }
        .api-test-btn {
            transition: all 0.3s ease;
            background-image: linear-gradient(45deg, #3b82f6 0%, #6366f1 100%);
        }
    </style>
</head>
<body class="bg-[#71717A] min-h-screen p-6">
    <div class="max-w-4xl mx-auto">
        <!-- 报警规则列表 -->
        <div class="mb-8">
            <h2 class="text-2xl font-bold text-white mb-4">当前报警规则</h2>
            <div id="rulesList" class="space-y-3">
                <!-- 规则示例 -->
                <div class="rule-card p-4 rounded-xl border border-white/10">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="font-semibold text-white">CO₂浓度超标</h3>
                            <p class="text-sm text-gray-300">当 CO₂ ＞ 1000ppm 时触发</p>
                        </div>
                        <div class="flex gap-2">
                            <button class="px-3 py-1 bg-blue-600/30 rounded-lg text-blue-400">编辑</button>
                            <button class="px-3 py-1 bg-red-600/30 rounded-lg text-red-400">删除</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 新增规则表单 -->
        <div class="rule-card p-6 rounded-xl border border-white/10">
            <h2 class="text-xl font-bold text-white mb-6">新增报警规则</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- 条件设置 -->
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-300 mb-2">监测参数</label>
                        <select class="w-full bg-white/5 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500">
                            <option>CO₂浓度</option>
                            <option>温度</option>
                            <option>湿度</option>
                            <option>PM2.5</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm text-gray-300 mb-2">触发条件</label>
                        <div class="flex gap-2">
                            <select class="bg-white/5 rounded-lg p-3 text-white flex-1">
                                <option>＞</option>
                                <option>≥</option>
                                <option>＜</option>
                                <option>≤</option>
                            </select>
                            <input type="number" 
                                   class="bg-white/5 rounded-lg p-3 text-white w-32"
                                   placeholder="阈值">
                            <select class="bg-white/5 rounded-lg p-3 text-white flex-1">
                                <option>ppm</option>
                                <option>°C</option>
                                <option>%</option>
                                <option>μg/m³</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 联动动作 -->
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-300 mb-2">触发动作</label>
                        <div class="space-y-3">
                            <div class="flex items-center gap-2">
                                <input type="checkbox" class="w-4 h-4 text-blue-500">
                                <span class="text-white">发送报警通知</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <input type="checkbox" class="w-4 h-4 text-blue-500">
                                <span class="text-white">启动应急程序</span>
                            </div>
                        </div>
                    </div>

                    <div class="pt-4 border-t border-white/10">
                        <h3 class="text-sm font-semibold text-white mb-3">第三方API配置</h3>
                        <div class="space-y-3">
                            <input type="url" 
                                   class="w-full bg-white/5 rounded-lg p-2 text-white"
                                   placeholder="API地址">
                            <div class="flex gap-2">
                                <select class="bg-white/5 rounded-lg p-2 text-white">
                                    <option>POST</option>
                                    <option>GET</option>
                                </select>
                                <input type="text"
                                       class="bg-white/5 rounded-lg p-2 text-white flex-1"
                                       placeholder="请求头 (JSON格式)">
                            </div>
                            <textarea class="w-full bg-white/5 rounded-lg p-2 text-white"
                                      rows="3"
                                      placeholder="请求体模板 (可使用{{value}}变量)"></textarea>
                            <button class="api-test-btn px-4 py-2 rounded-lg text-white hover:opacity-90">
                                测试API连接
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-6 flex justify-end gap-3">
                <button class="px-6 py-2 bg-gray-600/30 rounded-lg text-gray-300">取消</button>
                <button class="px-6 py-2 bg-blue-600/30 rounded-lg text-blue-400">保存规则</button>
            </div>
        </div>
    </div>

<script>
// 报警规则管理
class AlarmRules {
    constructor() {
        this.rules = [];
        this.loadRules();
    }

    addRule(rule) {
        this.rules.push(rule);
        this.saveRules();
        this.render();
    }

    deleteRule(index) {
        this.rules.splice(index, 1);
        this.saveRules();
        this.render();
    }

    saveRules() {
        localStorage.setItem('alarmRules', JSON.stringify(this.rules));
    }

    loadRules() {
        const stored = localStorage.getItem('alarmRules');
        this.rules = stored ? JSON.parse(stored) : [];
    }

    render() {
        const list = document.getElementById('rulesList');
        list.innerHTML = this.rules.map((rule, index) => `
            <div class="rule-card p-4 rounded-xl border border-white/10 mb-3">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="font-semibold text-white">${rule.parameter}报警</h3>
                        <p class="text-sm text-gray-300">当 ${rule.parameter} ${rule.condition} ${rule.threshold}${rule.unit}</p>
                        ${rule.actions.map(action => `
                            <span class="text-xs bg-blue-500/20 text-blue-400 px-2 py-1 rounded-full">${action}</span>
                        `).join(' ')}
                    </div>
                    <div class="flex gap-2">
                        <button class="px-3 py-1 bg-blue-600/30 rounded-lg text-blue-400">编辑</button>
                        <button onclick="alarmSystem.deleteRule(${index})" 
                                class="px-3 py-1 bg-red-600/30 rounded-lg text-red-400">删除</button>
                    </div>
                </div>
            </div>
        `).join('');
    }
}

// 初始化系统
const alarmSystem = new AlarmRules();

// 表单提交处理
document.querySelector('button').addEventListener('click', () => {
    const rule = {
        parameter: document.querySelector('select').value,
        condition: document.querySelectorAll('select')[1].value,
        threshold: document.querySelector('input[type="number"]').value,
        unit: document.querySelectorAll('select')[2].value,
        actions: [...document.querySelectorAll('input[type="checkbox"]:checked')]
                 .map(cb => cb.nextElementSibling.textContent)
    };
    
    alarmSystem.addRule(rule);
});

// API测试功能
document.querySelector('.api-test-btn').addEventListener('click', async () => {
    try {
        const response = await fetch('https://httpbin.org/post', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                sensor: "test",
                value: "{{value}}"
            })
        });
        
        if(response.ok) {
            alert('API测试成功！');
        }
    } catch (error) {
        alert('API连接失败');
    }
});
</script>
</body>
</html>