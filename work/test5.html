<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥ä¸šè®¾å¤‡æ™ºèƒ½ç›‘æ§ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-primary: #71717A;
            --text-primary: #F4F4F5;
            --accent-blue: #60A5FA;
            --accent-orange: #FB923C;
            --status-normal: #34D399;
            --status-warning: #FBBF24;
            --status-alert: #EF4444;
        }

        .glassy-panel {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            transition: all 0.3s ease;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(52, 211, 153, 0.4); }
            70% { box-shadow: 0 0 0 8px rgba(52, 211, 153, 0); }
            100% { box-shadow: 0 0 0 0 rgba(52, 211, 153, 0); }
        }

        .compare-date-picker {
            max-width: 0;
            overflow: hidden;
            transition: max-width 0.3s ease;
        }

        .compare-mode .compare-date-picker {
            max-width: 200px;
        }

        .chart-tooltip {
            background: rgba(39, 39, 42, 0.9) !important;
            border: 1px solid rgba(255,255,255,0.1) !important;
            border-radius: 6px !important;
        }
    </style>
</head>
<body class="bg-[#71717A] text-[#F4F4F5] min-h-screen p-6">
    <div class="max-w-7xl mx-auto">
        <!-- å®æ—¶ç›‘æ§çœ‹æ¿ -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <!-- æ¸©åº¦å¡ç‰‡ -->
            <div class="glassy-panel rounded-xl p-4 cursor-pointer parameter-card" data-param="temperature">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-2">
                        <div class="status-indicator bg-[var(--status-alert)]"></div>
                        <h2 class="text-lg font-semibold">ğŸŒ¡ï¸ è®¾å¤‡æ¸©åº¦</h2>
                    </div>
                    <span class="text-2xl font-mono">58.6â„ƒ</span>
                </div>
                <div class="h-32">
                    <canvas class="mini-chart" data-param="temperature"></canvas>
                </div>
            </div>

            <!-- å‹åŠ›å¡ç‰‡ -->
            <div class="glassy-panel rounded-xl p-4 cursor-pointer parameter-card" data-param="pressure">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-2">
                        <div class="status-indicator bg-[var(--status-warning)]"></div>
                        <h2 class="text-lg font-semibold">ğŸŒ€ ç®¡è·¯æ°”å‹</h2>
                    </div>
                    <span class="text-2xl font-mono">32.1kPa</span>
                </div>
                <div class="h-32">
                    <canvas class="mini-chart" data-param="pressure"></canvas>
                </div>
            </div>

            <!-- ç”µå‹å¡ç‰‡ -->
            <div class="glassy-panel rounded-xl p-4 cursor-pointer parameter-card" data-param="voltage">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-2">
                        <div class="status-indicator bg-[var(--status-normal)]"></div>
                        <h2 class="text-lg font-semibold">ğŸ”‹ ç”µæ± ç”µå‹</h2>
                    </div>
                    <span class="text-2xl font-mono">26.8V</span>
                </div>
                <div class="h-32">
                    <canvas class="mini-chart" data-param="voltage"></canvas>
                </div>
            </div>
        </div>

        <!-- å†å²åˆ†ææ¨¡æ€æ¡† -->
        <div id="historyModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="glassy-panel rounded-xl w-full max-w-4xl p-6">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h3 id="modalTitle" class="text-xl font-bold mb-2">æ¸©åº¦å†å²è¶‹åŠ¿</h3>
                            <div class="flex gap-2 items-center text-sm text-[#A1A1AA]">
                                <span id="currentValue" class="font-mono">58.6â„ƒ</span>
                                <span id="valueRange">å…è®¸èŒƒå›´ï¼š-20â„ƒ ~ 60â„ƒ</span>
                            </div>
                        </div>
                        <button class="text-2xl hover:text-[var(--accent-blue)] transition-colors" onclick="closeModal()">Ã—</button>
                    </div>
                    
                    <div class="flex flex-col lg:flex-row gap-4 mb-6">
                        <div class="flex gap-2 items-center">
                            <input type="date" id="mainDate" class="bg-[#52525B] px-3 py-1 rounded-lg" value="2024-03-20">
                            <button id="compareBtn" class="px-3 py-1 bg-[#52525B] hover:bg-[#3F3F46] rounded-lg transition-colors">
                                <span>ğŸ•’</span> å¯¹æ¯”æ¨¡å¼
                            </button>
                            <div id="compareDateContainer" class="compare-date-picker">
                                <input type="date" id="compareDate" class="bg-[#52525B] px-3 py-1 rounded-lg" value="2024-03-19">
                            </div>
                        </div>
                        <div id="diagnosisAdvice" class="text-sm p-3 rounded-lg bg-[#EF4444]/10 border border-[#EF4444]/30">
                            â— ä¸¥é‡è¶…æ ‡ï¼šç«‹å³åœæœºæ£€æŸ¥å†·å´ç³»ç»Ÿ
                        </div>
                    </div>

                    <div class="h-96">
                        <canvas id="historyChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
// å†å²æ•°æ®å­˜å‚¨
const historyData = {
    temperature: {
        '2024-03-20': generateHourlyData(58.6, 18),
        '2024-03-19': generateHourlyData(55.2, 16),
        '2024-03-18': generateHourlyData(53.8, 15)
    },
    pressure: {
        '2024-03-20': generateHourlyData(32.1, 7),
        '2024-03-19': generateHourlyData(29.8, 6),
        '2024-03-18': generateHourlyData(28.5, 5)
    },
    voltage: {
        '2024-03-20': generateHourlyData(26.8, 2),
        '2024-03-19': generateHourlyData(25.9, 1.8),
        '2024-03-18': generateHourlyData(25.3, 1.5)
    }
};

// ç³»ç»ŸçŠ¶æ€
let currentParam = 'temperature';
let isCompareMode = false;
let mainDate = '2024-03-20';
let compareDate = '2024-03-19';

// æ•°æ®ç”Ÿæˆå‡½æ•°
function generateHourlyData(base, amplitude) {
    return Array.from({length: 24}, (_, i) => 
        base + amplitude * Math.sin(i/4) + (Math.random() - 0.5) * 3
    );
}

// åˆå§‹åŒ–è¿·ä½ å›¾è¡¨
function initMiniCharts() {
    document.querySelectorAll('.mini-chart').forEach(canvas => {
        const param = canvas.dataset.param;
        const ctx = canvas.getContext('2d');
        
        const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
        gradient.addColorStop(0, param === 'temperature' ? '#60A5FA80' : 
                            param === 'pressure' ? '#FB923C80' : '#34D39980');
        gradient.addColorStop(1, param === 'temperature' ? '#3B82F620' : 
                            param === 'pressure' ? '#F9731620' : '#34D39920');

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array(24).fill().map((_,i) => i),
                datasets: [{
                    data: historyData[param][mainDate],
                    borderColor: param === 'temperature' ? '#60A5FA' : 
                               param === 'pressure' ? '#FB923C' : '#34D399',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true,
                    backgroundColor: gradient
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { x: { display: false }, y: { display: false } }
            }
        });
    });
}

// åˆå§‹åŒ–å†å²å›¾è¡¨
let historyChart = null;
function initHistoryChart() {
    const ctx = document.getElementById('historyChart').getContext('2d');
    if(historyChart) historyChart.destroy();
    
    historyChart = new Chart(ctx, {
        type: 'line',
        data: getChartData(),
        options: {
            responsive: true,
            plugins: {
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    backgroundColor: '#27272A',
                    titleColor: '#A1A1AA',
                    bodyColor: '#F4F4F5'
                },
                legend: {
                    labels: {
                        color: '#A1A1AA',
                        boxWidth: 12,
                        padding: 16
                    }
                }
            },
            scales: {
                y: {
                    grid: { color: 'rgba(255,255,255,0.08)' },
                    ticks: { color: '#A1A1AA' }
                },
                x: {
                    grid: { color: 'rgba(255,255,255,0.08)' },
                    ticks: { color: '#A1A1AA' }
                }
            }
        }
    });
}

// è·å–å›¾è¡¨æ•°æ®
function getChartData() {
    const mainData = historyData[currentParam][mainDate];
    const compareData = isCompareMode ? historyData[currentParam][compareDate] : null;

    return {
        labels: Array(24).fill().map((_,i) => `${i}:00`),
        datasets: [
            {
                label: mainDate,
                data: mainData,
                borderColor: '#60A5FA',
                borderWidth: 2,
                tension: 0.3,
                pointRadius: 3
            },
            ...(compareData ? [{
                label: compareDate,
                data: compareData,
                borderColor: '#FB923C',
                borderWidth: 2,
                borderDash: [5, 5],
                tension: 0.3,
                pointRadius: 3
            }] : [])
        ]
    };
}

// æ›´æ–°è¯Šæ–­å»ºè®®
function updateDiagnosis() {
    const adviceElement = document.getElementById('diagnosisAdvice');
    const currentValue = historyData[currentParam][mainDate][23];
    const { min, max } = getParamRange(currentParam);

    if(currentValue > max) {
        adviceElement.textContent = `â— ä¸¥é‡è¶…æ ‡ï¼š${getCriticalAdvice(currentParam)}`;
        adviceElement.className = 'text-sm p-3 rounded-lg bg-[#EF4444]/10 border border-[#EF4444]/30';
    } else if(currentValue > max * 0.9) {
        adviceElement.textContent = `âš ï¸ æ¥è¿‘ä¸Šé™ï¼š${getWarningAdvice(currentParam)}`;
        adviceElement.className = 'text-sm p-3 rounded-lg bg-[#FBBF24]/10 border border-[#FBBF24]/30';
    } else {
        adviceElement.textContent = 'âœ… å½“å‰çŠ¶æ€æ­£å¸¸';
        adviceElement.className = 'text-sm p-3 rounded-lg bg-[#34D399]/10 border border-[#34D399]/30';
    }
}

// å‚æ•°èŒƒå›´é…ç½®
function getParamRange(param) {
    return {
        temperature: { min: -20, max: 60 },
        pressure: { min: 20, max: 30 },
        voltage: { min: 21.6, max: 26.4 }
    }[param];
}

// äº‹ä»¶ç›‘å¬
document.querySelectorAll('.parameter-card').forEach(card => {
    card.addEventListener('click', function() {
        currentParam = this.dataset.param;
        mainDate = document.getElementById('mainDate').value;
        initHistoryChart();
        updateChart();
        updateModalInfo();
        document.getElementById('historyModal').classList.remove('hidden');
    });
});

document.getElementById('compareBtn').addEventListener('click', () => {
    isCompareMode = !isCompareMode;
    document.getElementById('historyModal').classList.toggle('compare-mode');
    document.getElementById('compareDateContainer').style.maxWidth = 
        isCompareMode ? '200px' : '0';
    updateChart();
});

document.getElementById('mainDate').addEventListener('change', e => {
    mainDate = e.target.value;
    updateChart();
    updateModalInfo();
});

document.getElementById('compareDate').addEventListener('change', e => {
    compareDate = e.target.value;
    updateChart();
});

// æ›´æ–°å›¾è¡¨
function updateChart() {
    if(historyChart) {
        historyChart.data = getChartData();
        historyChart.update();
    }
    updateDiagnosis();
}

// æ›´æ–°æ¨¡æ€æ¡†ä¿¡æ¯
function updateModalInfo() {
    const { min, max } = getParamRange(currentParam);
    const currentValue = historyData[currentParam][mainDate][23];
    
    document.getElementById('modalTitle').textContent = 
        `${getParamName(currentParam)}å†å²è¶‹åŠ¿`;
    document.getElementById('currentValue').textContent = 
        `${currentValue.toFixed(1)}${getParamUnit(currentParam)}`;
    document.getElementById('valueRange').textContent = 
        `å…è®¸èŒƒå›´ï¼š${min}${getParamUnit(currentParam)} ~ ${max}${getParamUnit(currentParam)}`;
}

// å·¥å…·å‡½æ•°
function getParamName(param) {
    return {
        temperature: 'æ¸©åº¦',
        pressure: 'æ°”å‹',
        voltage: 'ç”µå‹'
    }[param];
}

function getParamUnit(param) {
    return {
        temperature: 'â„ƒ',
        pressure: 'kPa',
        voltage: 'V'
    }[param];
}

function getCriticalAdvice(param) {
    return {
        temperature: 'ç«‹å³åœæœºæ£€æŸ¥å†·å´ç³»ç»Ÿ',
        pressure: 'ç´§æ€¥æ³„å‹å¹¶æ£€æŸ¥ç®¡è·¯å¯†å°',
        voltage: 'ç«‹å³æ–­å¼€ç”µæºæ£€æŸ¥ç”µæ± ç»„'
    }[param];
}

function getWarningAdvice(param) {
    return {
        temperature: 'å»ºè®®å¢åŠ æ•£çƒ­æªæ–½',
        pressure: 'æ£€æŸ¥å‹åŠ›è°ƒèŠ‚é˜€å·¥ä½œçŠ¶æ€',
        voltage: 'å»ºè®®è¿›è¡Œç”µæ± å¥åº·åº¦æ£€æµ‹'
    }[param];
}

// åˆå§‹åŒ–ç³»ç»Ÿ
window.addEventListener('DOMContentLoaded', () => {
    initMiniCharts();
    initHistoryChart();
});

function closeModal() {
    document.getElementById('historyModal').classList.add('hidden');
}
</script>
</body>
</html>